function peticionAJAX(e,t){var a=new XMLHttpRequest;document.querySelector(".loader-content").style.display="flex",a.onreadystatechange=function(){if(4===a.readyState){if(a.status>=100&&a.status<=300){var i=JSON.parse(a.responseText);t(i)}else console.error("ERROR AJAX! en",e,JSON.parse(a.responseText));document.querySelector(".loader-content").style.display="none"}},a.open("GET",e,!0),a.send()}function addPlaylist(e,t){playlistList="",e.forEach(function(e,t){playlistList+='<li class="playlist__item"><div class="playlist__item__image"><img src="'+e.image+'"></div><div class="playlist__item__title"><p class="name">'+e.name+'</p><p class="album">'+e.album+'</p></div><div class="playlist__item__buttons"><button class="play-preview" data-id="'+e.id+'" data-preview="'+e.previewURL+'"><i class="fa fa-play" aria-hidden="true"></i></button></div><div class="playlist__item__buttons"><button data-id="'+e.id+'" class="delete-button"><i class="fa fa-trash-o" aria-hidden="true"></i></button></div></div></li>'}),playlistItems.innerHTML=playlistList,0!=t&&(modalAddTrack.open(),modalAddTrack.setContent("The track is added"))}function deleteItemPlaylist(e){var t=[];itemsToPlaylist.forEach(function(e,a){t.push(e.id)}),audioObject&&audioObject.getAttribute("data-id")===e&&audioObject.pause();var a=t.indexOf(e);tracksToPlaylist.splice(a,1),itemsToPlaylist.splice(a,1),addPlaylist(itemsToPlaylist,!1),window.localStorage.setItem("playListStorage",JSON.stringify(itemsToPlaylist)),0===itemsToPlaylist.length&&(listName.setAttribute("disabled",!1),createPlaylistButton.setAttribute("disabled",!1))}function createPlaylist(e){playlistName=e.value;var t=new XMLHttpRequest;t.open("POST","/playlist"),t.setRequestHeader("Content-Type","application/json"),t.send(JSON.stringify({name:playlistName,tracksToAdd:tracksToPlaylist})),modalPlaylist.setContent("<p>The list has been created in your profile</p>"),modalPlaylist.open()}function cleanSearch(){itemsList="",itemsSearchResults.innerHTML=itemsList}function addItemsSearch(e){peticionAJAX("/apiSearch/data?keyword="+encodeURIComponent(e)+"&offset="+numOffset+"&searchType="+searchType,function(t){var a=(t=JSON.parse(t)).items;if(0===a.length){var i=new tingle.modal({onOpen:function(){searchInput.blur()},beforeClose:function(){this.destroy(),searchInput.value=""}});i.open(),i.setContent("No matches found")}else e!=searchWord&&(searchWord=e,cleanSearch()),a.forEach(function(e,t){itemsList+='<li class="c-item-box"><div class="c-item-box__img"><img src="'+e.imageAlbum+'"><div class="actions"><a title="play" class="track play-preview" data-preview="'+e.previewUrl+'" data-id="'+e.id+'"><i class="fa fa-play"  aria-hidden="true"></i></a><a title="add track" class="anade-playlist" data-uri="'+e.URITrack+'" data-id="'+e.id+' aria-hidden="true"><i class="fa fa-plus" ></i></a></div></div><div class="c-item-box__text"><p class="title">'+e.name+'</p><p class="subtitle">'+e.album+"</p></div></li>"}),itemsSearchResults.innerHTML=itemsList,10!=a.length&&addMoreWrap.classList.remove("hide"),a.length<8&&addMoreWrap.classList.add("hide")})}function searchSpoty(){if(""!=searchInput.value)cleanSearch(),addItemsSearch(searchInput.value.trim());else{var e=new tingle.modal({cssClass:["modal--error-search"],onOpen:function(){searchInput.blur()},beforeClose:function(){this.destroy()}});e.open(),e.setContent("The search is empty")}}var searchWord,audioObject=null,numOffset=0,tracksToPlaylist=[],itemsToPlaylist=[],playlistName="new playlist",playlistList="",itemsList="",searchButton=document.getElementById("searchButton"),searchInput=document.getElementById("searchField"),addMoreButton=document.getElementById("addMoreButton"),addMoreWrap=document.getElementById("addMoreWrap"),itemsSearchResults=document.getElementById("searchResults"),searchTypeCombo=document.getElementById("searchType"),playlistItems=document.getElementById("playlistItems"),createPlaylistButton=document.getElementById("playlistAdd"),mainApp=document.getElementById("mainApp"),modalAddTrack=new tingle.modal({closeMethods:["overlay","button","escape"],cssClass:["modal--add-track"],onOpen:function(){window.setTimeout(function(){modalAddTrack.close()},500)}});playlistItems.addEventListener("click",function(e){var t=e.target;if(t.classList.contains("anade-playlist")){var a=t.parentNode.parentNode.parentNode.parentNode;itemsToPlaylist.push({name:a.querySelector(".title").innerHTML,album:a.querySelector(".subtitle").innerHTML,image:a.querySelector("img").getAttribute("src"),previewURL:a.querySelector(".play-preview").getAttribute("data-preview"),URItrack:t.getAttribute("data-uri"),id:t.getAttribute("data-id")}),addPlaylist(itemsToPlaylist),tracksToPlaylist.push(t.getAttribute("data-uri")),console.log(tracksToPlaylist),listName.removeAttribute("disabled"),0!=listName.value&&createPlaylistButton.removeAttribute("disabled")}t.classList.contains("delete-button")&&deleteItemPlaylist(t.getAttribute("data-id"))}),listName.addEventListener("keyup",function(e){0!=this.value?(createPlaylistButton.removeAttribute("disabled"),13!=e.which&&13!=e.keyCode||createPlaylist(listName)):createPlaylistButton.setAttribute("disabled",!1)}),createPlaylistButton.addEventListener("click",function(e){createPlaylist(listName)});var modalPlaylist=new tingle.modal({closeMethods:[],footer:!0,stickyFooter:!0});modalPlaylist.addFooterBtn("NEW PLAYLIST","c-button tingle-btn",function(){playListStorage=[],itemsToPlaylist=[],tracksToPlaylist=[],playlistItems.innerHTML="",itemsSearchResults.innerHTML="",addMoreButton.style.display="none",listName.value="",listName.setAttribute("disabled",!1),createPlaylistButton.setAttribute("disabled",!1),audioObject&&audioObject.pause(),modalPlaylist.close()}),modalPlaylist.addFooterBtn("CONTINUE","c-button tingle-btn",function(){modalPlaylist.close()});var playListStorage;window.localStorage&&0!=window.localStorage.length&&(playListStorage=JSON.parse(window.localStorage.getItem("playListStorage")),addPlaylist(itemsToPlaylist=playListStorage,!1),itemsToPlaylist.forEach(function(e,t){tracksToPlaylist.push(e.URItrack)}),0===itemsToPlaylist.length?listName.setAttribute("disabled",!1):listName.removeAttribute("disabled"));var searchType=searchTypeCombo.options[searchTypeCombo.selectedIndex].getAttribute("data-id");searchTypeCombo.addEventListener("change",function(){searchType=searchTypeCombo.options[searchTypeCombo.selectedIndex].getAttribute("data-id")}),searchInput.addEventListener("keypress",function(e){13!=e.which&&13!=e.keyCode||searchSpoty()}),searchButton.addEventListener("click",function(e){searchSpoty()}),addMoreButton.addEventListener("click",function(e){numOffset+=8,addItemsSearch(searchWord)}),mainApp.addEventListener("click",function(e){var t=e.target;if(null!==t&&t.classList.contains("play-preview"))if(t.classList.contains("playing"))audioObject.pause();else{audioObject&&audioObject.pause();var a=t.getAttribute("data-preview");(audioObject=new Audio(a)).play(),audioObject.setAttribute("data-id",t.getAttribute("data-id")),console.log(),t.classList.add("playing"),t.querySelector(".fa").classList.add("fa-pause"),t.querySelector(".fa").classList.remove("fa-play"),t.setAttribute("title","pause track"),t.parentNode.classList.add("active"),audioObject.addEventListener("ended",function(){t.classList.remove("playing"),t.querySelector(".fa").classList.remove("fa-pause"),t.querySelector(".fa").classList.add("fa-play"),t.setAttribute("title","play track"),t.parentNode.classList.remove("active")}),audioObject.addEventListener("pause",function(){t.classList.remove("playing"),t.querySelector(".fa").classList.remove("fa-pause"),t.querySelector(".fa").classList.add("fa-play"),t.setAttribute("title","play track"),t.parentNode.classList.remove("active")})}if(t.classList.contains("anade-playlist")){var i=t.parentNode.parentNode.parentNode;itemsToPlaylist.push({name:i.querySelector(".title").innerHTML,album:i.querySelector(".subtitle").innerHTML,image:i.querySelector("img").getAttribute("src"),previewURL:i.querySelector(".play-preview").getAttribute("data-preview"),URItrack:t.getAttribute("data-uri"),id:t.getAttribute("data-id")}),addPlaylist(itemsToPlaylist),tracksToPlaylist.push(t.getAttribute("data-uri")),window.localStorage.setItem("playListStorage",JSON.stringify(itemsToPlaylist)),listName.removeAttribute("disabled"),0!=listName.value&&createPlaylistButton.removeAttribute("disabled")}});