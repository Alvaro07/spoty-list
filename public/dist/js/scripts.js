function peticionAJAX(t,e){var a=new XMLHttpRequest;document.querySelector(".loader-content").style.display="flex",a.onreadystatechange=function(){if(4===a.readyState){if(a.status>=100&&a.status<=300){var s=JSON.parse(a.responseText);e(s)}else console.error("ERROR AJAX! en",t,JSON.parse(a.responseText));document.querySelector(".loader-content").style.display="none"}},a.open("GET",t,!0),a.send()}function addPlaylist(t,e){playlistList="",t.forEach(function(t,e){playlistList+='<li class="playlist__item"><div class="playlist__item__image"><img src="'+t.image+'"></div><div class="playlist__item__title"><p class="name">'+t.name+'</p><p class="album">'+t.album+'</p></div><div class="playlist__item__buttons"><button class="play-preview" data-id="'+t.id+'" data-preview="'+t.previewURL+'"><i class="fa fa-play" aria-hidden="true"></i></button></div><div class="playlist__item__buttons"><button data-id="'+t.id+'" class="delete-button"><i class="fa fa-trash-o" aria-hidden="true"></i></button></div></div></li>'}),playlistItems.innerHTML=playlistList,0!=e&&(modalAddTrack.open(),modalAddTrack.setContent("The track is added"))}function deleteItemPlaylist(t){var e=[];itemsToPlaylist.forEach(function(t,a){e.push(t.id)}),audioObject&&audioObject.getAttribute("data-id")===t&&audioObject.pause();var a=e.indexOf(t);tracksToPlaylist.splice(a,1),itemsToPlaylist.splice(a,1),addPlaylist(itemsToPlaylist,!1),window.localStorage.setItem("playListStorage",JSON.stringify(itemsToPlaylist)),0===itemsToPlaylist.length&&(listName.setAttribute("disabled",!1),createPlaylistButton.setAttribute("disabled",!1))}function createPlaylist(t){playlistName=t.value;var e=new XMLHttpRequest;e.open("POST","/playlist"),e.setRequestHeader("Content-Type","application/json"),e.send(JSON.stringify({name:playlistName,tracksToAdd:tracksToPlaylist})),modalPlaylist.setContent("<p>The list has been created in your profile</p>"),modalPlaylist.open()}function cleanSearch(){itemsList="",itemsSearchResults.innerHTML=itemsList}function addItemsSearch(t){peticionAJAX("/apiSearch/data?keyword="+encodeURIComponent(t)+"&offset="+numOffset+"&searchType="+searchType,function(e){var a=(e=JSON.parse(e)).items;if(0===a.length){var s=new tingle.modal({onOpen:function(){searchInput.blur()},beforeClose:function(){this.destroy(),searchInput.value=""}});s.open(),s.setContent("No matches found")}else t!=searchWord&&(searchWord=t,cleanSearch()),a.forEach(function(t,e){itemsList+='<li class="c-item-box"><div class="c-item-box__img"><img src="'+t.imageAlbum+'"><div class="actions"><a title="play" class="track play-preview" data-preview="'+t.previewUrl+'" data-id="'+t.id+'"><i class="fa fa-play"  aria-hidden="true"></i></a><a title="add track" class="anade-playlist" data-uri="'+t.URITrack+'" data-id="'+t.id+' aria-hidden="true"><i class="fa fa-plus" ></i></a></div></div><div class="c-item-box__text"><p class="title">'+t.name+'</p><p class="subtitle">'+t.album+"</p></div></li>"}),itemsSearchResults.innerHTML=itemsList,10!=a.length&&addMoreWrap.classList.remove("hide"),a.length<8&&addMoreWrap.classList.add("hide")})}function searchSpoty(){if(""!=searchInput.value)cleanSearch(),addItemsSearch(searchInput.value.trim());else{var t=new tingle.modal({cssClass:["modal--error-search"],onOpen:function(){searchInput.blur()},beforeClose:function(){this.destroy()}});t.open(),t.setContent("The search is empty")}}var searchWord,audioObject=null,numOffset=0,tracksToPlaylist=[],itemsToPlaylist=[],playlistName="new playlist",playlistList="",itemsList="",searchButton=document.getElementById("searchButton"),searchInput=document.getElementById("searchField"),addMoreButton=document.getElementById("addMoreButton"),addMoreWrap=document.getElementById("addMoreWrap"),itemsSearchResults=document.getElementById("searchResults"),searchTypeCombo=document.getElementById("searchType"),playlistItems=document.getElementById("playlistItems"),createPlaylistButton=document.getElementById("playlistAdd"),mainApp=document.getElementById("mainApp"),modalAddTrack=new tingle.modal({closeMethods:["overlay","button","escape"],cssClass:["modal--add-track"],onOpen:function(){window.setTimeout(function(){modalAddTrack.close()},500)}});playlistItems.addEventListener("click",function(t){var e=t.target;e.classList.contains("delete-button")&&deleteItemPlaylist(e.getAttribute("data-id"))}),listName.addEventListener("keyup",function(t){0!=this.value?(createPlaylistButton.removeAttribute("disabled"),13!=t.which&&13!=t.keyCode||createPlaylist(listName)):createPlaylistButton.setAttribute("disabled",!1)}),createPlaylistButton.addEventListener("click",function(t){createPlaylist(listName)});var modalPlaylist=new tingle.modal({closeMethods:[],footer:!0,stickyFooter:!0});modalPlaylist.addFooterBtn("NEW PLAYLIST","c-button tingle-btn",function(){playListStorage=[],itemsToPlaylist=[],tracksToPlaylist=[],window.localStorage.setItem("playListStorage",JSON.stringify(itemsToPlaylist)),playlistItems.innerHTML="",itemsSearchResults.innerHTML="",addMoreWrap.style.display="none",listName.value="",listName.setAttribute("disabled",!1),createPlaylistButton.setAttribute("disabled",!1),audioObject&&audioObject.pause(),modalPlaylist.close()}),modalPlaylist.addFooterBtn("CONTINUE","c-button tingle-btn",function(){modalPlaylist.close()});var playListStorage;window.localStorage&&0!=window.localStorage.length&&(playListStorage=JSON.parse(window.localStorage.getItem("playListStorage")),addPlaylist(itemsToPlaylist=playListStorage,!1),itemsToPlaylist.forEach(function(t,e){tracksToPlaylist.push(t.URItrack)}),0===itemsToPlaylist.length?listName.setAttribute("disabled",!1):listName.removeAttribute("disabled"));var searchType=searchTypeCombo.options[searchTypeCombo.selectedIndex].getAttribute("data-id");searchTypeCombo.addEventListener("change",function(){searchType=searchTypeCombo.options[searchTypeCombo.selectedIndex].getAttribute("data-id")}),searchInput.addEventListener("keypress",function(t){13!=t.which&&13!=t.keyCode||searchSpoty()}),searchButton.addEventListener("click",function(t){searchSpoty()}),addMoreButton.addEventListener("click",function(t){numOffset+=8,addItemsSearch(searchWord)}),mainApp.addEventListener("click",function(t){function e(){var t=a.parentNode.parentNode.parentNode;itemsToPlaylist.push({name:t.querySelector(".title").innerHTML,album:t.querySelector(".subtitle").innerHTML,image:t.querySelector("img").getAttribute("src"),previewURL:t.querySelector(".play-preview").getAttribute("data-preview"),URItrack:a.getAttribute("data-uri"),id:a.getAttribute("data-id")}),addPlaylist(itemsToPlaylist),tracksToPlaylist.push(a.getAttribute("data-uri")),window.localStorage.setItem("playListStorage",JSON.stringify(itemsToPlaylist))}var a=t.target;if(null!==a&&a.classList.contains("play-preview"))if(a.classList.contains("playing"))audioObject.pause();else{audioObject&&audioObject.pause();var s=a.getAttribute("data-preview");(audioObject=new Audio(s)).play(),audioObject.setAttribute("data-id",a.getAttribute("data-id")),console.log(),a.classList.add("playing"),a.querySelector(".fa").classList.add("fa-pause"),a.querySelector(".fa").classList.remove("fa-play"),a.setAttribute("title","pause track"),a.parentNode.classList.add("active"),audioObject.addEventListener("ended",function(){a.classList.remove("playing"),a.querySelector(".fa").classList.remove("fa-pause"),a.querySelector(".fa").classList.add("fa-play"),a.setAttribute("title","play track"),a.parentNode.classList.remove("active")}),audioObject.addEventListener("pause",function(){a.classList.remove("playing"),a.querySelector(".fa").classList.remove("fa-pause"),a.querySelector(".fa").classList.add("fa-play"),a.setAttribute("title","play track"),a.parentNode.classList.remove("active")})}if(a.classList.contains("anade-playlist")){var i=[];for(var l in itemsToPlaylist)i.push(itemsToPlaylist[l].URItrack);if(-1!=i.indexOf(a.getAttribute("data-uri"))){console.log("Ya estoy en la playlist");var o=new tingle.modal({closeMethods:[],footer:!0,stickyFooter:!0});o.addFooterBtn("Add Track","c-button tingle-btn",function(){e(),o.close()}),o.addFooterBtn("No","c-button tingle-btn",function(){o.close()}),o.open(),o.setContent("the song is already in the playlist, are you sure you want to add it?")}else e();listName.removeAttribute("disabled"),0!=listName.value&&createPlaylistButton.removeAttribute("disabled")}});