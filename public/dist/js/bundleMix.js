function peticionAJAX(t,e){var a=new XMLHttpRequest;document.querySelector(".loader-content").style.display="flex",a.onreadystatechange=function(){if(4===a.readyState){if(a.status>=100&&a.status<=300){var i=JSON.parse(a.responseText);e(i)}else console.error("ERROR AJAX! en",t,JSON.parse(a.responseText));document.querySelector(".loader-content").style.display="none"}},a.open("GET",t,!0),a.send()}function addPlaylist(t,e){playlistList="",t.forEach(function(t,e){playlistList+='<li class="playlist__item"><div class="playlist__item__image"><img src="'+t.imageAlbum+'"></div><div class="playlist__item__title"><p class="name">'+t.name+'</p><p class="album">'+t.album+'</p></div><div class="playlist__item__buttons"><button class="play-preview" data-id="'+t.id+'" data-preview="'+t.previewURL+'"><i class="fa fa-play-circle-o" aria-hidden="true"></i></button></div><div class="playlist__item__buttons"><button data-id="'+t.id+'" class="delete-button"><i class="fa fa-trash-o" aria-hidden="true"></i></button></div></div></li>'}),playlistItems.innerHTML=playlistList,0!=e&&(smallModal.open(),smallModal.setContent("The track is added"))}function deleteItemPlaylist(t){var e=[];itemsToPlaylist.forEach(function(t,a){e.push(t.id)}),audioObject&&audioObject.getAttribute("data-id")===t&&audioObject.pause();var a=e.indexOf(t);tracksToPlaylist.splice(a,1),itemsToPlaylist.splice(a,1),addPlaylist(itemsToPlaylist,!1),window.localStorage.setItem("playListStorage",JSON.stringify(itemsToPlaylist)),0===itemsToPlaylist.length&&(listName.setAttribute("disabled",!1),createPlaylistButton.setAttribute("disabled",!1),listName.value="")}function resetPlaylist(){playListStorage=[],itemsToPlaylist=[],tracksToPlaylist=[],window.localStorage.clear()}function createPlaylist(t){playlistName=t.value;var e=new XMLHttpRequest;e.open("POST","/playlist"),e.setRequestHeader("Content-Type","application/json"),e.send(JSON.stringify({name:playlistName,tracksToAdd:tracksToPlaylist})),modalPlaylist.setContent("<p>The list has been created in your profile</p>"),modalPlaylist.open()}function toggleMenu(){pageWrap.classList.toggle("off"),mask.classList.toggle("show")}function printUserPlaylists(t){void 0===t&&(t="myUser");peticionAJAX("/apiPlaylists/dataPlaylists?user="+t,function(t){var e=(t=JSON.parse(t)).items;if(0===e.length){var a=new tingle.modal({onOpen:function(){searchInput.blur()},beforeClose:function(){this.destroy()}});a.open(),a.setContent("No matches found")}else itemsList="<option data-selector='index-option'>Select your playlist</option>",e.forEach(function(t,e){itemsList+="<option id="+t.id+" data-user="+t.ownerId+">"+t.name+"</option>"}),document.getElementById("comboMixOne").innerHTML=itemsList,document.getElementById("comboMixTwo").innerHTML=itemsList})}function PrintPlaylist(t,e,a){listaTemasArray=[],peticionAJAX("/apiListsTracks/:datatracks?id="+e+"&user="+a,function(e){var a="";return(e=JSON.parse(e)).items.forEach(function(t,e){a+='<li class="mix-list__item"><div class="mix-list__title"><p><span class="txt-bold">'+t.artist+"</span> / "+t.name+'</p></div><div class="mix-list__buttons"><button class="play-preview" title="play" data-id="'+t.id+'" data-preview="'+t.previewURL+'"><i class="fa fa-play-circle-o" aria-hidden="true"></i></button></div></li>',listaTemasArray.push(t)}),t.innerHTML=a,a="",t===areaMixOne?arrayMixOne=listaTemasArray:t===areaMixTwo&&(arrayMixTwo=listaTemasArray),watchEmptyMixlists(),listaTemasArray})}function reloadMixArea(t,e){null!=t.options[t.selectedIndex].getAttribute("id")?PrintPlaylist(e,t.options[t.selectedIndex].getAttribute("id"),t.options[t.selectedIndex].getAttribute("data-user")):t===comboMixOne?(arrayMixOne=[],areaMixOne.innerHTML="",listaTemasArray=[],watchEmptyMixlists()):t===comboMixTwo&&(arrayMixTwo=[],areaMixTwo.innerHTML="",listaTemasArray=[],watchEmptyMixlists())}function watchEmptyMixlists(){0!=arrayMixOne.length&&0!=arrayMixTwo.length?(addMoreWrap.classList.remove("hide"),mixPlaylistsButton.classList.remove("disabled")):(addMoreWrap.classList.add("hide"),mixPlaylistsButton.classList.add("disabled"))}function arrayRandom(t){for(var e,a,i=t.length;i;e=parseInt(Math.random()*i),a=t[--i],t[i]=t[e],t[e]=a);return t}var audioObject=null,mainApp=document.getElementById("mainApp"),pageWrap=document.getElementById("pageWrap"),mask=document.getElementById("mask");mainApp.addEventListener("click",function(t){var e=t.target;if(null!==e&&e.classList.contains("play-preview")){if("null"===e.getAttribute("data-preview"))return smallModal.open(),void smallModal.setContent("This track dont have audio preview");if(e.classList.contains("playing"))audioObject.pause();else{audioObject&&audioObject.pause();var a=e.getAttribute("data-preview");(audioObject=new Audio(a)).play(),audioObject.setAttribute("data-id",e.getAttribute("data-id")),e.classList.add("playing"),e.querySelector(".fa").classList.add("fa-pause"),e.querySelector(".fa").classList.remove("fa-play"),e.setAttribute("title","pause track"),e.parentNode.classList.add("active"),audioObject.addEventListener("ended",function(){e.classList.remove("playing"),e.querySelector(".fa").classList.remove("fa-pause"),e.querySelector(".fa").classList.add("fa-play"),e.setAttribute("title","play track"),e.parentNode.classList.remove("active")}),audioObject.addEventListener("pause",function(){e.classList.remove("playing"),e.querySelector(".fa").classList.remove("fa-pause"),e.querySelector(".fa").classList.add("fa-play"),e.setAttribute("title","play track"),e.parentNode.classList.remove("active")})}}});var smallModal=new tingle.modal({closeMethods:["overlay","button","escape"],cssClass:["modal--add-track"],onOpen:function(){window.setTimeout(function(){smallModal.close()},1e3)}}),tracksToPlaylist=[],itemsToPlaylist=[],playlistName="new playlist",playlistList="",itemsList="",playlistItems=document.getElementById("playlistItems"),createPlaylistButton=document.getElementById("playlistAdd"),addMoreWrap=document.getElementById("addMoreWrap");playlistItems.addEventListener("click",function(t){var e=t.target;e.classList.contains("delete-button")&&deleteItemPlaylist(e.getAttribute("data-id"))}),listName.addEventListener("keyup",function(t){0!=this.value?(createPlaylistButton.removeAttribute("disabled"),13!=t.which&&13!=t.keyCode||createPlaylist(listName)):createPlaylistButton.setAttribute("disabled",!1)}),createPlaylistButton.addEventListener("click",function(t){createPlaylist(listName)});var modalPlaylist=new tingle.modal({closeMethods:[],footer:!0,stickyFooter:!0});modalPlaylist.addFooterBtn("NEW PLAYLIST","c-button tingle-btn",function(){resetPlaylist(),playlistItems.innerHTML="",pageWrap.classList.contains("search-page")?(itemsSearchResults.innerHTML="",addMoreButton.style.display="none"):pageWrap.classList.contains("mix-page")&&(arrayMixOne=[],areaMixOne.innerHTML="",listaTemasArray=[],comboMixOne.selectedIndex="0",arrayMixTwo=[],areaMixTwo.innerHTML="",listaTemasArray=[],comboMixTwo.selectedIndex="0",watchEmptyMixlists()),listName.value="",listName.setAttribute("disabled",!1),createPlaylistButton.setAttribute("disabled",!1),audioObject&&audioObject.pause(),modalPlaylist.close()}),modalPlaylist.addFooterBtn("CONTINUE","c-button tingle-btn",function(){modalPlaylist.close()});var playListStorage=[];(window.localStorage=0!=window.localStorage.length)&&(playListStorage=JSON.parse(window.localStorage.getItem("playListStorage")),addPlaylist(itemsToPlaylist=playListStorage,!1),itemsToPlaylist.forEach(function(t,e){tracksToPlaylist.push(t.URItrack)}),0===itemsToPlaylist.length?listName.setAttribute("disabled",!1):listName.removeAttribute("disabled")),document.getElementById("toggleNav").addEventListener("click",function(t){toggleMenu()}),document.getElementById("closeNav").addEventListener("click",function(t){toggleMenu()}),mask.addEventListener("click",function(t){toggleMenu()}),document.getElementById("primaryNav").addEventListener("click",function(){resetPlaylist()});var areaMixOne=document.getElementById("areaMixOne"),areaMixTwo=document.getElementById("areaMixTwo"),areaMixFinal=document.getElementById("areaMixFinal"),comboMixOne=document.getElementById("comboMixOne"),comboMixTwo=document.getElementById("comboMixTwo"),mixPlaylistsButton=document.getElementById("mixPlaylistsButton"),playlistItemsMix=document.getElementById("playlistItemsMix"),arrayMixOne=[],arrayMixTwo=[],listaTemasArray=[];printUserPlaylists(),comboMixOne.addEventListener("change",function(){reloadMixArea(this,areaMixOne),arrayMixOne=listaTemasArray}),comboMixTwo.addEventListener("change",function(){reloadMixArea(this,areaMixTwo),arrayMixTwo=listaTemasArray}),mixPlaylistsButton.addEventListener("click",function(){smallModal.open(),smallModal.setContent("The Playlist is mixed"),tracksToPlaylist=[],(itemsToPlaylist=arrayRandom(arrayMixOne.concat(arrayMixTwo))).forEach(function(t,e){tracksToPlaylist.push(t.uri)}),addPlaylist(itemsToPlaylist,!1),window.localStorage.setItem("playListStorage",JSON.stringify(itemsToPlaylist)),listName.removeAttribute("disabled")});